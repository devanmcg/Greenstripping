---
title: Greenstrip figures
subtitle: 
date: '`r Sys.Date()`'
author: DAM
output:
  html_document:
    keep_md: false
    toc: false
    toc_float: false
    theme: united
    highlight: tango
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE,
                      fig.path = "C:/Users/devan.mcgranahan/GithubProjects/GreenstripSimulations/paper/figures/")

fp = 'C:/Users/devan.mcgranahan/GitHubProjects/Greenstripping'
pacman::p_load(tidyverse, sf, stars)

pacman::p_load_current_gh("devanmcg/wesanderson")

load(paste0(fp, '/objects/ros_results.Rdata'))

```


```{r mtt_output, fig.height=8}
ros_results %>%
  select(scenario, prop, ros) %>%
  separate(scenario, c('LM', 'width', 'units', 
                       'TL', 'FD', 'LF'), sep = '_') %>%
  select(-units) %>% 
  mutate(across(c(LM:LF), ~sub("^\\D+", "", .)), 
         `Fine:Coarse\nfuel ratio` = FD,
         `Total load` = paste0('\n', as.character(TL), ' t/ha'), 
         LM = as.numeric(LM)) %>%
  filter(width == "1") %>%
  ggplot() + theme_bw(14) + 
    geom_line(aes(y = prop*100, 
                  x = LM, 
                  color = LF, 
                  group = LF), 
              size = 1.1, 
              position = position_dodge(width = 1)) +
    geom_point(aes(y = prop*100, 
                  x = LM, 
                  fill = LF, 
                  shape = LF), 
              size = 2.5, 
              stroke = 1, 
              color = "lightgrey", 
              position = position_dodge(width = 1)) +
    labs(x = 'Live fuel moisture content (%)', 
         y = 'Protected area burned (%)') +
    scale_shape_manual("Live:Dead\nfuel ratio",
                       values = c(23, 22, 21, 24)) +
    scale_fill_manual("Live:Dead\nfuel ratio",
                       values = wes_palette("FuelMoisture4")) +
    scale_color_manual("Live:Dead\nfuel ratio",
                       values = wes_palette("FuelMoisture4")) +
    scale_x_continuous(breaks = seq(30, 120, length.out = 4), 
                       labels = seq(30, 120, length.out = 4)) +
    facet_grid(`Fine:Coarse\nfuel ratio` ~`Total load`, 
               labeller = label_both) +
    theme(strip.text.y = element_text(angle = 0), 
          panel.grid.minor.x = element_blank() )
```

```{r mtt_example}
load(paste0(fp, '/objects/mtt_paths.Rdata'))
fuels <- raster::raster(paste0(fp, '/FB/MTT/inputs/fuels.asc'))
fuels_stars <- st_as_stars(fuels)

ig_sf <- read_sf(paste0(fp, '/FB/MTT/inputs'), 
                 'ignitions')

ggplot() + theme_bw() + 
  geom_stars(data = fuels_stars) + 
  geom_sf(data = mtt_paths, 
          color = 'red' ) +
  geom_sf(data = ig_sf, 
          pch = 21, 
          fill = 'yellow', 
          color = 'orange') +   
 # scale_fill_manual(values = wes_palette("Zissou1", 6, type = "continuous")) +
  
  facet_wrap(~ Strip)
```